<!DOCTYPE html>
<html>
<head>
    <title>d3.js with leaflet.js</title>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css" />
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
    <script src="../lib/jquery.js" type="text/javascript"></script>
    <script src="res/obisk.js"></script>
    <title>Analiza in vizualizacija dejavnikov vpliva na obiskanost organizacij</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link href="../css/style.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <div id="navbarload"></div> <!-- Tukaj se naloÅ¾i navigacija strani -->
    <h2 class="text-center">Porazdelitev obiskov po vhodih BTC hale A</h2>
    <div id="map" class="center-block" style="width: 600px; height: 600px"></div>
    <script type="text/javascript">

    var parseDate = d3.time.format("%d-%m-%y").parse;

    var vhodi = {"A": 0, "B":0, "C":0, "D": 0, "E":0, "sum":0};
    var vhodiScale = 100;
    function get_data(vhod){
    Obisk.getBTCVisitsInput(vhod,new Date(2014,10,1), new Date(2014,10,20),function(visits){
        visits.forEach(function(visit){
            vhodi[vhod] += parseInt(visit.val_int);
        });
        vhodi.sum +=  vhodi[vhod];

        //
        d3.json("res/circle.json", function(collection) {

    // Add a LatLng object to each item in the dataset
            collection.objects.forEach(function(d) {
                d.LatLng = new L.LatLng(d.circle.coordinates[0],
                        d.circle.coordinates[1]);
            });
            console.log(vhodi);
            var feature = g.selectAll("circle")
                    .data(collection.objects)
                    .enter().append("circle")
                    .style("stroke", "black")
                    .style("opacity", .6)
                    .style("fill", "red")
                    .attr("r", function(d){
                        console.log(vhodi.sum)
                        return vhodi[d.circle.name]/vhodi.sum*vhodiScale;
                    }) .on("mouseover", function(d){
                        d3.select(this).transition()
                                .ease('circle-out')
                                .duration('200').attr('r', vhodi[d.circle.name]/vhodi.sum*vhodiScale*2)
                                .style('cursor','pointer');

                    }) .on("mouseout", function(d) {
                        d3.select(this).transition().transition()
                                .ease('circle-out')
                                .duration(200)
                                .attr('r', vhodi[d.circle.name]/vhodi.sum*vhodiScale);});
            map.on("viewreset", update);
            update();
            function update() {
                feature.attr("transform",
                        function(d) {
                            return "translate("+
                                    map.latLngToLayerPoint(d.LatLng).x +","+
                                    map.latLngToLayerPoint(d.LatLng).y +")";
                        }
                )
            }
        })
    });}
    get_data("A");
    get_data("B");
    get_data("C");
    get_data("D");
    get_data("E");

    map = L.map('map').setView([46.066776, 14.542722], 17);
        mapLink =
                '<a href="http://openstreetmap.org">OpenStreetMap</a>';
        L.tileLayer(
                'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; ' + mapLink + ' Contributors',
                    maxZoom: 18,
                }).addTo(map);
        // Initialize the SVG layer
        map._initPathRoot();
        // We pick up the SVG from the map object
        var svg = d3.select("#map").select("svg"),
                g = svg.append("g");
    </script>
    <hr class="featurette-divider">
    <div id="footerload"></div>
  </div>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <script>
    $( "#navbarload" ).load( "../navbar.html" );
    $( "#footerload" ).load( "../footer.html" );
  </script>

</body>
</html>

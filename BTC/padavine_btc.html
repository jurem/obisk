<!DOCTYPE HTML>
<html>
    
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Analiza in vizualizacija dejavnikov vpliva na obiskanost organizacij</title>
        <link href="../css/style.css" rel="stylesheet">
        <script type="text/javascript" src="jquery.min.js"></script>
        <script type="text/javascript" src="highcharts.js"></script>
        <script type="text/javascript">
            $(function () { 
            //podatki za vse. Dobro bi bilo, ce bi mi to brali iz baze ali vsaj CSVja
            var data = [7551,6624,7193,7490,8542,9297,4564,8404,8157,9030,8321,9206,9211,4446,8268,7731,7659,7547,9001,9253,4572,7495,6778,7773,8412,8322,8941,4206,6852,7374,8009];
            var vhodA = [513,462,557,557,601,612,267,704,558,628,572,708,721,234,771,638,596,652,706,502,269,534,519,525,856,512,524,161,419,529,487]
            var vhodB = [1584,1326,1628,1508,1461,1719,804,1745,1534,1786,1637,1949,1792,740,1766,1403,1744,1433,1565,1547,743,1267,1142,1531,1284,1146,1179,414,930,1275,1331]
            var vhodC = [2290,1681,1892,2016,2351,2639,1406,2140,2127,2271,2084,2665,2751,1412,2258,2082,1966,2005,2543,2512,1473,1905,1663,1995,1865,2151,2027,1032,1344,2038,2040]
            var vhodD = [786,871,865,937,1135,966,461,1279,988,1156,1164,1093,978,464,1047,998,915,1003,1061,1115,402,1047,910,941,1423,1093,1293,509,1118,887,1017]
            var vhodE = [2378,2284,2251,2472,2994,3361,1626,2536,2950,3189,2864,2791,2969,1596,2426,2610,2438,2454,3126,3577,1685,2742,2544,2781,2984,3420,3918,2090,3041,2645,3134]
            var padavine = [1.9, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.6, 0.0, 0.0, 1.9, 0.1, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 5.1, 0.0, 0.0, 0.3, 3.4, 0.0, 0.0, 0.0, 0.0, 8.9, 0.0];
            
            //podatek o prvem in o zadnjem datumu
            var dateStart = Date.UTC(2013,6,1);
            var dateEnd = Date.UTC(2013,6,31);
            //referenca na veliki graf
            var  detailChart;
        
            $(document).ready(function () {
        
                // ustvari veliki graf
                function createDetail(masterChart) {
        
                    
                    //pripravimo veliki graf
                    var detailPadavine = [];
                    var detailVhodA = [];
                    var detailVhodB = [];
                    var detailVhodC = [];
                    var detailVhodD = [];
                    var detailVhodE = [];
                    //veliki graf naj se zacne z prvim dnem podatkov         
                    var detailStart = dateStart;
                    
                    // napolnimo iz izbranega obmocja
                    $.each(masterChart.series[0].data, function () {
                        if (this.x >= detailStart) {
                            detailPadavine.push(this.y);
                        }
                    });
                    $.each(masterChart.series[1].data, function () {
                        if (this.x >= detailStart) {
                            detailVhodA.push(this.y);
                        }
                    });
                    $.each(masterChart.series[2].data, function () {
                        if (this.x >= detailStart) {
                            detailVhodB.push(this.y);
                        }
                    });
                     $.each(masterChart.series[3].data, function () {
                        if (this.x >= detailStart) {
                            detailVhodC.push(this.y);
                        }
                    });
                     $.each(masterChart.series[4].data, function () {
                        if (this.x >= detailStart) {
                            detailVhodD.push(this.y);
                        }
                    });
                     $.each(masterChart.series[5].data, function () {
                        if (this.x >= detailStart) {
                            detailVhodE.push(this.y);
                        }
                    });

        
                    // ustvarimo veliki graf in referenco na globalno spremenljivko
                    detailChart = $('#detail-container').highcharts({
                        chart: {
                            marginBottom: 120,
                            reflow: false,
                            marginLeft: 175,
                            marginRight: 75,
                            //zoomType: 'xy',
                            style: {
                                position: 'absolute'
                            }
                        },
                        title: {
                            text: 'Obisk BTCja glede na padavine'
                        },
                        subtitle: {
                            text: 'Izberite podroƒçje z izbiro na spodnjem grafu'
                        },
                        xAxis: {
                            type: 'datetime',
                            crosshair: true // navpicna crta
                        },
                        yAxis: [{
                           labels: {
                            format: '{value} mm',
                            style: {
                                color: Highcharts.getOptions().colors[0]
                            }
                           },
                            title: {
                                text: 'Padavine',
                                style: {
                                    color: Highcharts.getOptions().colors[0]
                                }
                            }
                        },{ // Secondary yAxis
                            title: {
                                text: 'Obiskovalci',
                                style: {
                                    color: Highcharts.getOptions().colors[1]
                                }
                            },
                            labels: {
                                format: '{value}',
                                style: {
                                    color: Highcharts.getOptions().colors[1]
                                }
                            },
                            opposite: true,
                            
                        }],
                        tooltip: {
                            shared: true,
                            followPointer: true,
                            headerFormat: '<span style="font-size: 10px">{point.key}. July</span><br/>'
                        },
                        legend: {
                            layout: 'vertical',
                            align: 'left',
                            x: 0,
                            verticalAlign: 'top',
                            y: 120,
                            floating: true,
                            backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'
                        },
                        plotOptions: {
                            series: {
                                marker: {
                                    enabled: false,
                                    states: {
                                        hover: {
                                            enabled: true,
                                            radius: 3
                                        }
                                    }
                                }
                            }
                        },
                        series: [
                        {
                            name: 'Padavine',
                            pointStart: dateStart,
                            pointInterval: 24 * 3600 * 1000,
                            type: 'column',
                            data: detailPadavine,
                            tooltip: {
                                valueSuffix: ' mm'
                            }
                        },{
                            name: 'Vhod A',
                            type: 'spline',
                            pointStart: dateStart,
                            pointInterval: 24 * 3600 * 1000,
                            yAxis: 1,
                            data: detailVhodA
                        },{
                            name: 'Vhod B',
                            type: 'spline',
                            pointStart: dateStart,
                            pointInterval: 24 * 3600 * 1000,
                            yAxis: 1,
                            data: detailVhodB
                        },{
                            name: 'Vhod C',
                            type: 'spline',
                            pointStart: dateStart,
                            pointInterval: 24 * 3600 * 1000,
                            yAxis: 1,
                            data: detailVhodC
                        },{
                            name: 'Vhod D',
                            type: 'spline',
                            pointStart: dateStart,
                            pointInterval: 24 * 3600 * 1000,
                            yAxis: 1,
                            data: detailVhodD
                        },{
                            name: 'Vhod E',
                            type: 'spline',
                            pointStart: dateStart,
                            pointInterval: 24 * 3600 * 1000,
                            yAxis: 1,
                            data: detailVhodE

                    }],
        
                        exporting: {
                            enabled: false
                        }
        
                    }).highcharts();
                }
        
                // ustvarimo mali graf
                function createMaster() {
                    $('#master-container').highcharts({
                        chart: {
                            reflow: false,
                            borderWidth: 0,
                            backgroundColor: null,
                            marginLeft: 175,
                            marginRight: 70,
                            zoomType: 'x',
                            events: {
        
                                // poslusamo za spremembe
                                selection: function (event) {
                                    var extremesObject = event.xAxis[0],
                                        min = extremesObject.min,
                                        max = extremesObject.max,
                                    
                                        detailPadavine = [],
                                        detailVhodA = [],
                                        detailVhodB = [],
                                        detailVhodC = [],
                                        detailVhodD = [],
                                        detailVhodE = [],
                                        xAxis = this.xAxis[0];
        
                                    // izberemo podateke na izbranem obmocju
                                    $.each(this.series[0].data, function () {
                                        if (this.x > min && this.x < max) {
                                            detailPadavine.push([this.x, this.y]);
     
                                        }
                                    });
                                    $.each(this.series[1].data, function () {
                                        if (this.x > min && this.x < max) {
                                            detailVhodA.push([this.x, this.y]);
                                        }
                                    });
                                    $.each(this.series[2].data, function () {
                                        if (this.x > min && this.x < max) {
                                            detailVhodB.push([this.x, this.y]);
                                        }
                                    });
                                    $.each(this.series[3].data, function () {
                                        if (this.x > min && this.x < max) {
                                            detailVhodC.push([this.x, this.y]);
                                        }
                                    });
                                    $.each(this.series[4].data, function () {
                                        if (this.x > min && this.x < max) {
                                            detailVhodD.push([this.x, this.y]);
                                        }
                                    });
                                    $.each(this.series[5].data, function () {
                                        if (this.x > min && this.x < max) {
                                            detailVhodE.push([this.x, this.y]);
                                        }
                                    });
        
                                    // lastnosti spodnjega grafa - maske(barve)
                                    xAxis.removePlotBand('mask-before');
                                    xAxis.addPlotBand({
                                        id: 'mask-before',
                                        from: dateStart,
                                        to: min,
                                        color: 'rgba(0, 0, 0, 0.2)'
                                    });
        
                                    xAxis.removePlotBand('mask-after');
                                    xAxis.addPlotBand({
                                        id: 'mask-after',
                                        from: max,
                                        to: dateEnd,
                                        color: 'rgba(0, 0, 0, 0.2)'
                                    });
        
        
                                    detailChart.series[0].setData(detailPadavine);
                                    detailChart.series[1].setData(detailVhodA);
                                    detailChart.series[2].setData(detailVhodB);
                                    detailChart.series[3].setData(detailVhodC);
                                    detailChart.series[4].setData(detailVhodD);
                                    detailChart.series[5].setData(detailVhodE);
      
        
                                    return false;
                                }
                            }
                        },
                        title: {
                            text: null
                        },
                        xAxis: {
                            type: 'datetime',
                            showLastTickLabel: true,
                            maxZoom: 14 * 24 * 3600000,
                            plotBands: [{
                                id: 'mask-before',
                                from: dateStart,
                                to: dateEnd,
                                color: 'rgba(0, 0, 0, 0.2)'
                            }],
                            title: {
                                text: null
                            }
                        },
                        yAxis: [{
                            title: {
                                text: null,
                            },
                            labels: {
                                enabled:false
                            }
                            },{ 
                            title: {
                                text: null,
                            },
                            labels: {
                                enabled: false
                            },
                            opposite: true,
                            
                        }],
                        tooltip: {
                            formatter: function () {
                                return false;
                            }
                        },
                        legend: {
                            enabled: false
                        },
                        credits: {
                            enabled: false
                        },
                        plotOptions: {
                            series: {
                                fillColor: {
                                    linearGradient: [0, 0, 0, 70],
                                    stops: [
                                        [0, Highcharts.getOptions().colors[0]],
                                        [1, 'rgba(255,255,255,0)']
                                    ]
                                },
                                lineWidth: 1,
                                marker: {
                                    enabled: false
                                },
                                shadow: false,
                                states: {
                                    hover: {
                                        lineWidth: 1
                                    }
                                },
                                enableMouseTracking: false
                            }
                        },
        
                        series: [{
                            name: 'Padavine',
                            pointStart: dateStart,
                            pointInterval: 24 * 3600 * 1000,
                            type: 'column',
                            data: padavine
    
                        },{
                            name: 'Vhod A',
                            type: 'spline',
                            pointStart: dateStart,
                            pointInterval: 24 * 3600 * 1000,
                            yAxis: 1,
                            data: vhodA
                        },{
                            name: 'Vhod B',
                            type: 'spline',
                            pointStart: dateStart,
                            pointInterval: 24 * 3600 * 1000,
                            yAxis: 1,
                            data: vhodB
                        },{
                            name: 'Vhod C',
                            type: 'spline',
                            pointStart: dateStart,
                            pointInterval: 24 * 3600 * 1000,
                          yAxis: 1,
                            data: vhodC
                        },{
                            name: 'Vhod D',
                            type: 'spline',
                            pointStart: dateStart,
                            pointInterval: 24 * 3600 * 1000,
                           yAxis: 1,
                            data: vhodD
                        },{
                            name: 'Vhod E',
                            type: 'spline',
                            pointStart: dateStart,
                            pointInterval: 24 * 3600 * 1000,
                           yAxis: 1,
                            data: vhodE

                    }],
        
                        exporting: {
                            enabled: false
                        }
        
                    }, function (masterChart) {
                        createDetail(masterChart);
                    })
                        .highcharts(); 
                }
        
                // pozicioniraj mali (master) in veliki(detail) graf
                var $container = $('#container')
                    .css('position', 'relative');
        
                $('<div id="detail-container">')
                    .css({ position: 'relative', height: 600, width: '100%' })
                    .appendTo($container);
        
                $('<div id="master-container">')
                    .css({ position: 'absolute', top: 500, height: 100, width: '100%'})
                    .appendTo($container);
        
                // ustvari mali graf
                createMaster();
            });
        
        });
        </script>
    </head>
    
    <body>
        <div class="container">
            <div id="container" style="width: 1000px; margin: 0 auto"></div>
        </div>
    </body>

</html>